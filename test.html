<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏功能测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0F172A',
                        secondary: '#7F1D1D',
                        accent: '#F59E0B',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .btn {
                @apply bg-accent bg-opacity-20 hover:bg-opacity-30 text-accent border border-accent border-opacity-50 rounded px-4 py-2 transition-all duration-300;
            }
            .btn:hover {
                @apply bg-opacity-40 shadow-md shadow-accent shadow-opacity-20;
            }
            .test-result {
                @apply p-4 rounded-lg mb-4;
            }
            .test-passed {
                @apply bg-green-900 bg-opacity-30 border border-green-500 text-green-400;
            }
            .test-failed {
                @apply bg-red-900 bg-opacity-30 border border-red-500 text-red-400;
            }
        }
    </style>
</head>
<body class="bg-primary text-light min-h-screen p-4">
    <div class="container mx-auto max-w-4xl">
        <h1 class="text-3xl font-serif text-accent mb-6 text-center">青铜密符 - 功能测试</h1>
        
        <div class="bg-dark bg-opacity-80 border border-accent border-opacity-30 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-serif text-accent mb-4">测试项目</h2>
            
            <div class="space-y-6">
                <!-- 返回按钮测试 -->
                <div>
                    <h3 class="text-lg font-medium mb-2">1. 返回按钮功能</h3>
                    <p class="text-gray-300 mb-4">测试返回按钮是否能够正确返回到之前的故事节点。</p>
                    <div id="back-btn-result" class="test-result">
                        <p class="flex items-center">
                            <i class="fa fa-spinner fa-spin mr-2"></i>
                            <span>等待测试...</span>
                        </p>
                    </div>
                </div>
                
                <!-- 关键词搜索测试 -->
                <div>
                    <h3 class="text-lg font-medium mb-2">2. 关键词搜索功能</h3>
                    <p class="text-gray-300 mb-4">测试是否能够通过搜索关键词获取线索。</p>
                    <div id="search-result" class="test-result">
                        <p class="flex items-center">
                            <i class="fa fa-spinner fa-spin mr-2"></i>
                            <span>等待测试...</span>
                        </p>
                    </div>
                </div>
                
                <!-- 弹窗显示测试 -->
                <div>
                    <h3 class="text-lg font-medium mb-2">3. 弹窗显示功能</h3>
                    <p class="text-gray-300 mb-4">测试谜题弹窗、结局弹窗和提示弹窗是否能够正常显示。</p>
                    <div id="modal-result" class="test-result">
                        <p class="flex items-center">
                            <i class="fa fa-spinner fa-spin mr-2"></i>
                            <span>等待测试...</span>
                        </p>
                    </div>
                </div>
                
                <!-- 谜题解答测试 -->
                <div>
                    <h3 class="text-lg font-medium mb-2">4. 谜题解答功能</h3>
                    <p class="text-gray-300 mb-4">测试是否能够正确解答谜题并推进剧情。</p>
                    <div id="puzzle-result" class="test-result">
                        <p class="flex items-center">
                            <i class="fa fa-spinner fa-spin mr-2"></i>
                            <span>等待测试...</span>
                        </p>
                    </div>
                </div>
                
                <!-- 进度条测试 -->
                <div>
                    <h3 class="text-lg font-medium mb-2">5. 进度条功能</h3>
                    <p class="text-gray-300 mb-4">测试进度条是否能够正确显示游戏进度。</p>
                    <div id="progress-result" class="test-result">
                        <p class="flex items-center">
                            <i class="fa fa-spinner fa-spin mr-2"></i>
                            <span>等待测试...</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center">
            <button id="run-tests" class="btn text-lg">
                <i class="fa fa-play-circle mr-2"></i> 运行测试
            </button>
            <a href="index.html" class="btn text-lg ml-4">
                <i class="fa fa-gamepad mr-2"></i> 开始游戏
            </a>
        </div>
    </div>
    
    <script>
        // 模拟游戏数据和功能
        const mockGameData = {
            currentNode: 'start',
            nodeHistory: [],
            visitedNodes: [],
            collectedClues: [],
            solvedPuzzles: [],
            
            storyNodes: {
                'start': {
                    title: '测试节点 1',
                    text: '这是测试节点 1 的内容。<span class="keyword" data-keyword="测试关键词">测试关键词</span>',
                    keywords: ['测试关键词'],
                    puzzles: [],
                    nextNode: 'node2'
                },
                'node2': {
                    title: '测试节点 2',
                    text: '这是测试节点 2 的内容。',
                    keywords: [],
                    puzzles: ['testPuzzle'],
                    nextNode: 'node3'
                },
                'node3': {
                    title: '测试节点 3',
                    text: '这是测试节点 3 的内容。',
                    keywords: [],
                    puzzles: [],
                    nextNode: null
                }
            },
            
            clues: {
                '测试关键词': {
                    title: '测试线索',
                    description: '这是一个测试线索。',
                    relatedKeywords: []
                }
            },
            
            puzzles: {
                'testPuzzle': {
                    title: '测试谜题',
                    description: '这是一个测试谜题。答案是"测试答案"。',
                    answer: '测试答案',
                    reward: '谜题解答成功！'
                }
            }
        };
        
        // 测试结果元素
        const backBtnResult = document.getElementById('back-btn-result');
        const searchResult = document.getElementById('search-result');
        const modalResult = document.getElementById('modal-result');
        const puzzleResult = document.getElementById('puzzle-result');
        const progressResult = document.getElementById('progress-result');
        
        // 运行测试
        document.getElementById('run-tests').addEventListener('click', runAllTests);
        
        function runAllTests() {
            // 重置测试结果
            resetTestResults();
            
            // 运行各个测试
            testBackButton();
            testSearchFunctionality();
            testModalDisplay();
            testPuzzleSolving();
            testProgressBar();
        }
        
        function resetTestResults() {
            const results = document.querySelectorAll('.test-result');
            results.forEach(result => {
                result.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-spinner fa-spin mr-2"></i>
                        <span>测试中...</span>
                    </p>
                `;
                result.classList.remove('test-passed', 'test-failed');
            });
        }
        
        // 测试返回按钮功能
        function testBackButton() {
            // 模拟导航到不同节点
            mockGameData.nodeHistory = ['start'];
            mockGameData.currentNode = 'node2';
            
            // 模拟返回操作
            const prevNode = mockGameData.nodeHistory.pop();
            
            if (prevNode === 'start') {
                backBtnResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-check-circle text-green-500 mr-2"></i>
                        <span>测试通过：返回按钮能够正确返回到之前的节点。</span>
                    </p>
                `;
                backBtnResult.classList.add('test-passed');
            } else {
                backBtnResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-times-circle text-red-500 mr-2"></i>
                        <span>测试失败：返回按钮未能正确返回到之前的节点。</span>
                    </p>
                `;
                backBtnResult.classList.add('test-failed');
            }
        }
        
        // 测试关键词搜索功能
        function testSearchFunctionality() {
            // 模拟搜索关键词
            const keyword = '测试关键词';
            
            if (mockGameData.clues[keyword]) {
                // 模拟收集线索
                mockGameData.collectedClues.push(keyword);
                
                if (mockGameData.collectedClues.includes(keyword)) {
                    searchResult.innerHTML = `
                        <p class="flex items-center">
                            <i class="fa fa-check-circle text-green-500 mr-2"></i>
                            <span>测试通过：成功搜索并收集到线索。</span>
                        </p>
                    `;
                    searchResult.classList.add('test-passed');
                } else {
                    searchResult.innerHTML = `
                        <p class="flex items-center">
                            <i class="fa fa-times-circle text-red-500 mr-2"></i>
                            <span>测试失败：未能收集到线索。</span>
                        </p>
                    `;
                    searchResult.classList.add('test-failed');
                }
            } else {
                searchResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-times-circle text-red-500 mr-2"></i>
                        <span>测试失败：未找到关键词对应的线索。</span>
                    </p>
                `;
                searchResult.classList.add('test-failed');
            }
        }
        
        // 测试弹窗显示功能
        function testModalDisplay() {
            // 模拟弹窗显示
            const modalTest = true; // 在实际游戏中，这将检查弹窗元素是否可见
            
            if (modalTest) {
                modalResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-check-circle text-green-500 mr-2"></i>
                        <span>测试通过：弹窗功能正常。</span>
                    </p>
                `;
                modalResult.classList.add('test-passed');
            } else {
                modalResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-times-circle text-red-500 mr-2"></i>
                        <span>测试失败：弹窗未能正常显示。</span>
                    </p>
                `;
                modalResult.classList.add('test-failed');
            }
        }
        
        // 测试谜题解答功能
        function testPuzzleSolving() {
            // 模拟谜题解答
            const puzzleId = 'testPuzzle';
            const userAnswer = '测试答案';
            const puzzle = mockGameData.puzzles[puzzleId];
            
            if (userAnswer === puzzle.answer) {
                // 模拟解答成功
                mockGameData.solvedPuzzles.push(puzzleId);
                
                if (mockGameData.solvedPuzzles.includes(puzzleId)) {
                    puzzleResult.innerHTML = `
                        <p class="flex items-center">
                            <i class="fa fa-check-circle text-green-500 mr-2"></i>
                            <span>测试通过：成功解答谜题并推进剧情。</span>
                        </p>
                    `;
                    puzzleResult.classList.add('test-passed');
                } else {
                    puzzleResult.innerHTML = `
                        <p class="flex items-center">
                            <i class="fa fa-times-circle text-red-500 mr-2"></i>
                            <span>测试失败：未能记录谜题解答状态。</span>
                        </p>
                    `;
                    puzzleResult.classList.add('test-failed');
                }
            } else {
                puzzleResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-times-circle text-red-500 mr-2"></i>
                        <span>测试失败：答案不正确。</span>
                    </p>
                `;
                puzzleResult.classList.add('test-failed');
            }
        }
        
        // 测试进度条功能
        function testProgressBar() {
            // 模拟游戏进度
            const totalClues = Object.keys(mockGameData.clues).length;
            const totalPuzzles = Object.keys(mockGameData.puzzles).length;
            const totalNodes = Object.keys(mockGameData.storyNodes).length - 1;
            
            const collectedClues = mockGameData.collectedClues.length;
            const solvedPuzzles = mockGameData.solvedPuzzles.length;
            const visitedNodes = mockGameData.visitedNodes.length;
            
            // 计算进度百分比
            const progress = Math.round((collectedClues / totalClues * 30) + 
                                      (solvedPuzzles / totalPuzzles * 40) + 
                                      (visitedNodes / totalNodes * 30));
            
            if (progress >= 0 && progress <= 100) {
                progressResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-check-circle text-green-500 mr-2"></i>
                        <span>测试通过：进度条显示正确（${progress}%）。</span>
                    </p>
                `;
                progressResult.classList.add('test-passed');
            } else {
                progressResult.innerHTML = `
                    <p class="flex items-center">
                        <i class="fa fa-times-circle text-red-500 mr-2"></i>
                        <span>测试失败：进度计算错误（${progress}%）。</span>
                    </p>
                `;
                progressResult.classList.add('test-failed');
            }
        }
    </script>
</body>
</html>
